# グローバル Claude Code 設定

> キーワード: **MUST** / **NEVER** = 必須。**SHOULD** = 推奨。**MAY** = 任意。

## ユーザー

- 音声入力（AQUA Voice）を頻繁に使用する。カタカナ変換や誤変換が混じるので、文脈で判断すること

## 全般

- 今日の日付が必要な場合、MUST `date` コマンドで取得する。モデルの内部知識に頼らない
- MUST CLAUDE.mdやMEMORY.md等の設定ファイルへの追加・変更はユーザーに確認してから行う
- MUST できないことは正直に「できない」と言う。できるふりをしない
- MUST 推測で仕様を語らない。実装コード等の一次情報で検証する

## Git 操作

> このセクションのルールは、プロジェクトの CLAUDE.md で明示的に異なる指示がある場合はそちらに従う。

- NEVER ユーザーの明示的な許可なく `git commit`, `git push` 等を実行しない
- MUST 変更前に `git branch` または `git status` で現在のブランチを確認する
- NEVER `git add .` や `git add <directory>` は使わない。ファイルを個別に追加する
- NEVER 未追跡ファイルを削除しない
- NEVER `git push --force` は使わない
- NEVER `git rebase` は使わない
- MUST コミットメッセージにプレフィックスをつける: `feat:`, `fix:`, `refactor:`, `docs:`, `chore:`
- MAY 読み取り専用操作（`git status`, `git diff`, `git log`）は自由に実行してよい
- SHOULD 意味のある変更ごとにコミットする
- SHOULD フィーチャーブランチを作成してPR/MRを出す

## 変更スコープのルール

- MUST 明示的に依頼された変更のみ行う。機能、ツール、パッケージ等を勝手に追加しない
- MUST 追加が必要と思われる場合は、まず確認する
- SHOULD PR/MRコメント、コミットメッセージ、ドキュメントは簡潔に

## デバッグの方針

- MUST 修正を試みる前に根本原因を特定する
- NEVER 場当たり的な修正（ハードコーディング、回避策）は使わない
- MUST リグレッション調査時はgit履歴/diffを確認する
- MUST デバッグに飛びつく前に、ユーザーの意図を理解する
- MUST 質問を受けたら、作業せずまず回答する

## コーディングスタイル

### 哲学

- **YAGNI**: 今必要ないものは作らない。将来の仮定に基づいた設計をしない
- **KISS**: シンプルさを最優先する。後方互換のためだけのshimやfallbackは、複雑さを増やすなら入れない
- **DRY**: 同じコードを繰り返さない。重複を見つけたらリファクタリングする
- **コンパクトな関数**: 一目で全体を把握できる小さな関数に分割する
- **明確な命名**: 関数名・変数名でストーリーが伝わるようにする
- **最小スコープ**: 変数のスコープをできるだけ小さく保つ
- **読みやすい流れ**: コードが物語のように読めること

### ルール

- MUST 関数は20行以内に収める。超える場合は分割する
- SHOULD 読みやすい場合は命令型ループより関数型アプローチを優先する
- SHOULD コールバックチェーンより `async/await` を優先する
- NEVER マジックナンバーは使わない。名前付き定数を使う
- SHOULD 変数名に単位を含める（例: `timeout_ms`, `distance_km`）
- SHOULD コメントはWHY（なぜこの実装か）を書く。WHATは複数行の処理の場合のみ
- MUST 失敗しうる操作には try/catch をつける
  - ネットワークリクエストにはタイムアウト処理を含める
  - コンテキスト付きの意味あるエラーメッセージを提供する

## バグ修正 / 機能要望のワークフロー

1. MUST ユーザーと要件を議論・明確化する
2. MUST スコープが明確になったらGitHub Issueを作成する
3. MUST リポジトリの `plans/` ディレクトリにプランファイルを作成する
4. MUST プランに基づいて実装する
5. MUST PR/MRの説明に「User Prompt」セクションとしてユーザーの元の依頼を含める

## ドキュメントのメンテナンス

- MUST 変更後にREADME.mdを確認し、正しい仕様を反映する
- MUST コマンド例、オプション、使い方の説明が正確であることを確認する

## 継続的な学習と自動化

- タスク完了後にセッションを振り返り、ユーザーの修正や繰り返しの指示があればルールの不足を評価・提案する
- 同じ指示が2回以上繰り返された場合、MUST 自動化を提案する:
  - **CLAUDE.md**: ルール、ガイドライン、ワークフロー
  - **Skill/Command**: パラメータ化可能な実行アクション
  - **Script**: 複雑な複数ステップの操作
  - **Settings/Hooks**: パーミッションや動作の自動化
